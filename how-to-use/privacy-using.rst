.. _privacy-using:

Добавление в сеть новой ноды
------------------------------

Новые ноды можно добавлять в сеть в любой момент времени. Настройка конфигурационных файлов новой ноды описана 
в подразделе :ref:`Подключение к существующей сети <configuration>`. Далее будут описаны действия, выполняемые при подключении новой ноды в сеть.

1. Пользователь генерирует криптографически связанную пару ключей - публичный и приватный, которые сохраняются в хранилище ключей ноды (keyStore).
2. Администратор сети (нода с ролью "Connection-manager") получает от нового пользователя публичный ключ и описание ноды, далее создаёт транзакцию :ref:`111 RegisterNodeTransaction <RegisterNodeTransaction>` с полученными данными.
3. Транзакция попадает в блок и далее в стейты нод участников сети. Вследствие транзакции среди сохраняемых данных каждый участник сети хранит обязательно публичный ключ и адрес новой ноды.
4. При необходимости администратор сети может добавить новой ноде дополнительные роли при помощи транзакции :ref:`102 PermitTransaction <PermitTransaction>`.
5. Пользователь запускает :ref:`ноду <install-node>`.
6. После запуска нода отправляет handshake-сообщение со своим публичным ключом участникам из списка "peers" своего конфигурационного файла.
7. Участники сети сравнивают публичный ключ из handshake-сообщения и ключ из транзакции 111, отправленной администратором сети. Если проверка успешна, участник сети обновляет свою БД и рассылает в сеть сообщение :ref:`Peers Message <network-message-PeersMessage>`.
8. Успешно подключившись, новая нода выполняет синхронизацию с сетью и получает таблицу адресов участников сети.


.. _data-privacy-exchange:

Процесс обмена конфиденциальными данными
-----------------------------------------

Отправка данных:

1. Создать политику доступа путем подписания и отправки CreatePolicyTransaction транзакции. ВСТАВИТЬ ССЫЛКУ НА API
2. Через :ref:`REST API <rest-api-node>` ноды вызвать метод :ref:`POST /privacy/sendData <privacy-api>`, в который передать отправляемые данные.

Получение данных:

1. Опросить ``GET /privacy/getData/{hash}`` участника, входящего в одну из сторон политики доступа.





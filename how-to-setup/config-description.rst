
.. _config-description:

Описание параметров конфигурационного файла ноды
====================================================

Конфигурационный файл ноды содержит основные настройки для работы блокчейна Vostok. В состав файла входят следующие секции:

* ``vostok`` - общая секция, куда входят все секции настройки блокчейна.
* ``blockchain`` - настройка основных параметров блокчейна.
* ``network`` - сетевые настройки.
* ``wallet`` - настройка доступа к закрытым ключам ноды.
* ``miner`` - настройка майнинга.
* ``rest-api`` - настройка REST API.
* ``synchronization`` - настройка синхронизации ноды с блокчейном.
* ``utx`` - настройка хранилища неавторизованных транзакций.
* ``features`` - настройка дополнительных параметров ноды.
* ``transaction-rebroadcaster`` - настройка повторной отправки транзакций в блокчейн.
* ``docker-engine`` - настройка Docker смарт-контрактов.

.. _vostok-sect-conf:

Секция ``vostok``
---------------------

Секция ``vostok`` включает все остальные секции настроек блокчейна, а также следующие отдельные параметры:

* ``waves-crypto`` - тип :ref:`шифрования <cryptography>` в блокчейне. Возможные значения: ``yes`` - выбор криптографии Waves, ``no`` - выбор ГОСТ-криптографии.
* ``directory`` - основная директория для хранения ПО ноды. В данном параметре указывается путь к директории в формате, приемлемом для текущей ОС.
* ``data-directory`` - директория для хранения данных блокчейна в LevelDB: блоки, транзакции, стейт ноды. В данном параметре указывается путь к директории в формате, приемлемом для текущей ОС.
* ``leveldb-cache-size`` - ограничение размера кэш-памяти, используемой для валидации блоков. Значение параметра числовое. Низкое значение уменьшает загрузку памяти, более высокое значение вместе с потреблением памяти увеличивает производительность ноды. Значение ``0`` отключает кэширование.
* ``max-cache-size`` - максимальный объём кэш-памяти. Значение параметра числовое. 
* ``max-rollback-depth`` - количество блоков, на которые можно откатить ноду назад.
* ``remember-blocks-interval-in-cache`` - количество запоминаемых блоков в кэш-памяти. 
* ``ntp-server`` - адрес NTP-сервера.
* ``logging-level`` - уровень логирования работы ноды. Возможные значения: ``DEBUG``, ``INFO``, ``WARN``, ``ERROR``, по умолчанию установлено значение ``INFO``.
* ``owner-address`` - адрес ноды, которая будет владельцем конфигурационного файла. Значение параметра строковое.
* ``scheduler-service.enable`` - активация :ref:`анкоринга <anchoring>`. Формат значений: ``yes`` или ``no``.

.. _blockchain-sect-conf:

Секция ``blockchain``
-----------------------

Секция отвечает за основные параметры блокчейна и включает в себя следующие параметры:

* ``type`` - тип блокчейна. Возможные значения ``DEFAULT`` или ``CUSTOM``.
* ``consensus.type`` - тип :ref:`консенсуса <consensus>` в блокчейне. Возможные значения ``PoS`` или ``PoA``.
* ``fee`` - список :ref:`комиссий <transaction-structure>` за транзакции в блокчейне.

При выборе типа блокчейна ``CUSTOM`` появляется дополнительная возможность на

* ``address-scheme-character`` - байт сети, для "Vostok Mainnet" - ``V``, для "Vostok Partnernet" - ``P``.
* ``functionality`` - настройка основных параметров блокчейна.
* ``genesis`` - настройка параметров генезис-блока.

**Блок** ``functionality``

* ``feature-check-blocks-period`` - количество блоков, через которые выполняется проверка и активация опций блокчейна. Значение параметра числовое.
* ``blocks-for-feature-activation`` - количество блоков, через которые применяется активированная опция. Значение параметра числовое.
* ``pre-activated-features`` - 
* ``double-features-periods-after-height`` - 

**Блок** ``genesis``

* ``average-block-delay`` - средняя задержка создания блоков. Значение указывается в секундах.
* ``initial-base-target`` - 
* ``timestamp`` - числовой код даты и времени. Значение параметра числовое.
* ``block-timestamp`` - 
* ``initial-balance`` - начальный баланс сети. Значение параметра числовое.
* ``genesis-public-key-base-58`` - хеш публичного ключа генезис-блока, зашифрованный в Base58. Значение параметра строковое.
* ``signature`` - хеш подписи генезис-блока. Значение параметра строковое.
* ``transactions`` - список участников сети с первоначальным балансом, создание которых войдёт в генезис-блок в виде генезис-транзакций. Значение параметра - массив.
* ``network-participants`` - список сетевых участников с ролями, создание которых войдёт в генезис-блок в виде генезис-транзакций. Значение параметра - массив.

Секция ``network``
-------------------------

Секция содержит сетевые настройки и включает в себя следующие параметры:

* ``file`` - путь к файлу с адресами известных участников сети и участников, доступ в сеть которым запрещён (blacklist). В данном параметре указывается путь к директории в формате, приемлемом для текущей ОС.
* ``bind-address`` - сетевой адрес ноды. Значение параметра строковое.
* ``port`` - номер порта. Значение параметра числовое.
* ``node-name`` - имя ноды для отправки во время процедуры handshake.
* ``nonce`` - 
* ``known-peers`` - список известных сетевых адресов нод. Значение параметра - массив.
* ``declared-address`` - сетевой адрес ноды вместе с номером порта. Значение параметра строковое.
* ``peers-data-residence-time`` - период хранения информации о пирах в БД с момента последнего контакта с ними.
* ``black-list-residence-time`` - период бана пира, на который он должен оставаться в чёрном списке после бана.
* ``break-idle-connections-timeout`` - период, за который при отсутствии сообщений от пира прерывается соединение с ним.
* ``max-inbound-connections`` - максимальное количество соединений с внутренними сетями.
* ``max-outbound-connections`` - максимальное количество соединений с внешними сетями.
* ``max-single-host-connections`` - максимальное количество соединений с отдельными хостами.
* ``tx-buffer-size`` - максимальный размер буфера для транзакций.
* ``connection-timeout`` - таймаут соединения с другими пирами.
* ``max-unverified-peers`` - максимальное количество непроверенных пиров.
* ``enable-peers-exchange`` - активация опции обмена информацией об известных пирах.
* ``enable-blacklisting`` - активация возможности бана пиров и создания чёрного списка.
* ``peers-broadcast-interval`` - интервал отправки в сеть списка известных пиров.
* ``handshake-timeout`` - таймаут для процедуры handshake.
* ``suspension-residence-time`` - 
* ``received-txs-cache-timeout`` - таймаут, за который удаляются из кэш-памяти транзакции с истёкшим сроком. 

**Блок** ``upnp``

Блок для настройки UPnP, используемой для работы блокчейна в домашней сети с применением роутеров или маршрутизаторов. Если ваш блокчейн работает в облаке, данную настройку рекомендуется не применять и установить значение ``enable = no``.

* ``enable`` - активация использования UPnP.
* ``gateway-timeout`` - таймаут соединения со шлюзом.
* ``discover-timeout`` - таймаут обнаружения.

**Блок** ``traffic-logger``

БЛОК логирования входящих и исходящих сообщений.

* ``ignore-tx-messages`` - список кодов игнорируемых отправляемых сообщений.
* ``ignore-rx-messages`` - список кодов игнорируемых получаемых сообщений.

Секция ``wallet``
---------------------

* ``file`` - директория для хранения приватных ключей. В данном параметре указывается путь к директории в формате, приемлемом для текущей ОС.
* ``password`` - пароль для доступа к файлу с приватными ключами.
* ``seed`` - секретная фраза для восстановления доступа к аккаунту.

Секция ``miner``
-----------------------

* ``enable`` - активация опции майнинга.
* ``quorum`` - необходимое количество соединений для создания блока. Значение ``0`` позволит генерировать блоки оффлайн.
* ``interval-after-last-block-then-generation-is-allowed`` - период времени, не позднее которого происходит генерация блоков только в последнем блоке.
* ``no-quorum-mining-delay`` - задержка майнинга при отсутствии кворума.
* ``micro-block-interval`` - интервал между микроблоками.
* ``max-transactions-in-key-block`` - максимальное количество транзакций в ключевом блоке.
* ``max-transactions-in-micro-block`` - максимальное количество транзакций в микроблоке.
* ``min-micro-block-age`` - минимальный возраст микроблока.
* ``retry-for-contract-execution-complete-interval`` - интервал, за который майнер проверяет исполненные Docker-контракты для создания микроблоков.

Секция ``rest-api``
-----------------------

* ``enable`` - активация опции REST API на ноде.
* ``bind-address`` - сетевой адрес ноды для привязки REST API.
* ``port`` - порт прослушивания REST API запросов.
* ``api-key-hash``- хеш от ключевой строки доступа к REST API.
* ``privacy-api-key-hash`` - хеш от ключевой строки доступа к методам ``privacy``.
* ``cors`` - поддержка кросс-доменных запросов к REST API.
* ``api-key-different-host`` - активация поддержки REST API ключа от других хостов.
* ``transactions-by-address-limit`` - максимальное количество транзакций, возвращаемых методом ``/transactions/address/{address}/limit/{limit}``.
* ``distribution-address-limit`` 

Секция ``synchronization``
-------------------------------

* ``max-rollback`` - максимальное количество блоков, на которые можно откатить ноду при форке. Если при форке разница высот нод больше указанного значения, откат невозможен.
* ``max-chain-length`` -
* ``synchronization-timeout`` - период синхронизации для получения всех запрашиваемых блоков.
* ``score-ttl`` - 

**Блок** ``invalid-blocks-storage``

Блок для настройки невалидных блоков в кэш-памяти.

* ``max-size`` - максимальное количество элементов в кэш-памяти.
* ``timeout`` - период хранения невалидных блоков и их владельцев в чёрном списке.
 
 **Блок** ``history-replier``

 Блок настроек репликации истории кэш-памяти.

* ``max-micro-block-cache-size`` - максимальное количество микроблоков для кэширования.
* ``max-block-cache-size``- максимальное количество блоков для кэширования.
 
**Блок** ``utx-synchronizer``

Блок настроек синхронизации неподтверждённых транзакций.

* ``network-tx-cache-size`` - максимальный объём кэш-памяти для неподтверждённых транзакций.
* ``network-tx-cache-time`` - максимальное время кэширования для неподтверждённых транзакций.
* ``max-buffer-size`` - максимальное количество транзакций в буфере. При достижении лимита буфера нода обработает все транзакции в пакетном режиме.
* ``max-buffer-time`` - максимальное время хранения транзакций в буфере. При достижении лимита времени нода обработает все транзакции в пакетном режиме.

**Блок** ``micro-block-synchronizer``

* ``wait-response-timeout`` - максимальное время ожидания до нового запроса на создание следующего микроблока.
* ``processed-micro-blocks-cache-timeout`` - время хранения подписей обработанных микроблоков.
* ``inv-cache-timeout`` - время хранения микроблоков с информацией об их нодах для предотвращения повторной обработки.

Секция ``utx``
-----------------

* ``max-size`` - количество хранимых неподтверждённых транзакций.
    # Memory limit, default - 1 Gb
    ``memory-limit`` - лимит памяти по умолчанию.
    # Utx cleanup task interval
    ``cleanup-interval`` - интервал запуска очистки пула неподтверждённых транзакций
    # Blacklist transactions from these addresses (Base58 strings)
    ``blacklist-sender-addresses`` = []
    # Allow transfer transactions from the blacklisted addresses to these recipients (Base58 strings)
    ``allow-blacklisted-transfer-to`` = []
    # Allow transactions from smart accounts
    ``allow-transactions-from-smart-accounts`` = true












